/**
 * ATG Core functionality
 *
 * Author: @kevinlearynet
 */(function(e){e.atg||(e.atg={});e.atg.utils=function(){this.constants={TEMPLATE_DIR:"templates/",MODEL_DIR:"data/",DEBUG:!1};this.init=function(){e.atg.utils().loadViews()};this.log=function(e){window.console&&window.console.log&&e&&console.log(e)};this.cachedScript=function(t,n){var r=t.length,i=function(){o++},s=[],o=0,u=0;for(;u<r;u++){var a=e.ajax({url:t[u],dataType:"script",cache:!0,success:i});s.push(a);delete a}jQuery.when.apply(null,s).then(function(){n&&n()})};this.getTemplateAjax=function(t,n,r,i){e.ajax({url:n,cache:e.atg.constants.DEBUG,success:function(e){var n=dust.compile(e,t);dust.loadSource(n);dust.render(t,r,function(e,t){i&&i(e,t)})}})};this.loadViews=function(){var t=e("[data-template][data-file][data-model]");if(t.length>0){deps=["js/dust-full-1.1.1.min.js"];this.cachedScript(deps,function(){t.each(function(){var t=e(this).data("template"),n=e(this).data("model"),r=e(this).data("file"),i=e(this);e.getJSON(e.atg.constants.MODEL_DIR+n,function(n){e.atg.constants.DEBUG&&e.atg.utils().log(n);e.atg.utils().getTemplateAjax(t,e.atg.utils().constants.TEMPLATE_DIR+r,n,function(t,n){t&&e.atg.utils().constants.DEBUG&&e.atg.utils().log(t);i.html(n)})})})})}};return this};e.atg.utils().init()})(jQuery);